define(["jquery","core/templates","core/notification","core/ajax","core/str","mod_threesixty/question_bank","core/yui"],function(a,b,c,d,e,f){var g,h={DELETE:'[data-action="delete-item"]',MOVE_UP:'[data-action="move-item-up"]',MOVE_DOWN:'[data-action="move-item-down"]'},i=function(a){g=a,this.registerEvents()};return i.refreshItemList=function(){var e=d.call([{methodname:"mod_threesixty_get_items",args:{threesixtyid:g}}]);a.when(e[0]).then(function(c){var d={threesixtyid:g},e=[],f=c.items.length;return a.each(c.items,function(a,b){var c=b;c.deletebutton=!0,c.moveupbutton=!1,c.movedownbutton=!1,c.type=b.typetext,f>1&&(1==b.position?c.movedownbutton=!0:b.position==f?c.moveupbutton=!0:b.position>1&&b.position<f&&(c.moveupbutton=!0,c.movedownbutton=!0)),e.push(c)}),d.allitems=e,b.render("mod_threesixty/list_360_items",d)}).done(function(c,d){a('[data-region="itemlist"]').replaceWith(c),b.runTemplateJS(d)}).fail(c.exception)},i.callItemAction=function(b,e){var f=d.call([{methodname:b,args:{itemid:e}}]);f[0].done(function(b){if(b.result)return i.refreshItemList(),!0;var c=b.warnings.join(a("<br/>"));throw new Error(c)}).fail(c.exception)},i.prototype.registerEvents=function(){a("#btn-question-bank").click(function(a){a.preventDefault(),f.init(g)}),a(h.DELETE).click(function(b){b.preventDefault();var c=a(this).data("itemid");i.callItemAction("mod_threesixty_delete_item",c)}),a(h.MOVE_UP).click(function(b){b.preventDefault();var c=a(this).data("itemid");i.callItemAction("mod_threesixty_move_item_up",c)}),a(h.MOVE_DOWN).click(function(b){b.preventDefault();var c=a(this).data("itemid");i.callItemAction("mod_threesixty_move_item_down",c)})},i});