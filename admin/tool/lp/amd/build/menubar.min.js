define(["jquery"],function(a){var b=!1,c=!1,d=function(){a(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),c=!1},e=function(a,b){this.menuRoot=a,this.handlers=b,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return e.prototype.openSubMenu=function(a){this.setOpenDirection(),d(),a.attr("aria-hidden","false"),c=!0},e.prototype.addEventListeners=function(){var e=this;b===!1&&(a(document).click(function(){c&&d()}),b=!0),this.subMenuItems.mouseenter(function(){return a(this).addClass("menu-hover"),!0}),this.subMenuItems.mouseout(function(){return a(this).removeClass("menu-hover"),!0}),this.allItems.click(function(b){return e.handleClick(a(this),b)}),this.allItems.keydown(function(b){return e.handleKeyDown(a(this),b)}),this.allItems.focus(function(){return e.handleFocus(a(this))}),this.allItems.blur(function(){return e.handleBlur(a(this))})},e.prototype.handleClick=function(b,c){c.stopPropagation();var e=b.parent();if(!e.is(".tool-lp-menu")){this.allItems.removeClass("menu-hover menu-focus"),d();var f=b.find("a").first(),g=new a.Event("click");g.target=f;var h=!1;return this.handlers&&a.each(this.handlers,function(c,d){if(h)return!1;if(b.find(c).length>0){var e=a.proxy(d,f);h=e(g)===!1||g.isDefaultPrevented()}}),h||"#"===f.attr("href")||(window.location.href=f.attr("href")),!0}return"true"==b.children("ul").first().attr("aria-hidden")?this.openSubMenu(b.children("ul").first()):d(),!1},e.prototype.handleFocus=function(a){if(null===this.activeItem)this.activeItem=a;else if(a[0]!=this.activeItem[0])return!0;var b=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");if(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),b.addClass("menu-focus"),this.isChildOpen===!0){var c=a.parent();c.is(".tool-lp-menu")&&"true"==a.attr("aria-haspopup")&&this.openSubMenu(a.children("ul").first())}return!0},e.prototype.handleBlur=function(a){return a.removeClass("menu-focus"),!0},e.prototype.setOpenDirection=function(){var b=this.menuRoot.offset(),c=a(document.body).hasClass("dir-rtl"),d=160,e=!1;c?b.left-d<0&&(e=!0):b.left+d>a(window).width()&&(e=!0),e?this.menuRoot.addClass("tool-lp-menu-open-left"):this.menuRoot.removeClass("tool-lp-menu-open-left")},e.prototype.handleKeyDown=function(b,c){if(c.altKey||c.ctrlKey)return!0;switch(c.keyCode){case this.keys.tab:d(),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var e=b.parent();return e.is(".tool-lp-menu")||(this.activeItem=e.parent(),this.isChildOpen=!1,this.activeItem.focus()),d(),c.stopPropagation(),!1;case this.keys.enter:case this.keys.space:var f=b.parent();if(!f.is(".tool-lp-menu")){this.allItems.removeClass("menu-hover"),this.allItems.removeClass("menu-focus"),d(),this.activeItem=null;var g=b.find("a").first(),h=new a.Event("click");h.target=g;var i=!1;return this.handlers&&a.each(this.handlers,function(c,d){if(i)return!1;if(b.find(c).length>0){var e=a.proxy(d,g);i=e(h)===!1||h.isDefaultPrevented()}}),i||(window.location.href=g.attr("href")),!0}return this.openSubMenu(b.children("ul").first()),c.stopPropagation(),!1;case this.keys.left:return this.activeItem=this.moveToPrevious(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(b),this.activeItem.focus(),c.stopPropagation(),!1}return!0},e.prototype.moveToNext=function(a){var b=a.parent(),c=b.children("li"),e=c.length,f=c.index(a),g=null,h=null;if(b.is(".tool-lp-menu"))g=e-1>f?a.next():c.first(),"true"==a.attr("aria-haspopup")&&(h=a.children("ul").first(),"false"==h.attr("aria-hidden")&&(d(),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===g.attr("aria-haspopup")&&this.isChildOpen===!0&&(h=g.children("ul").first(),this.openSubMenu(h));else if("true"==a.attr("aria-haspopup"))h=a.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h);else{var i=null,j=null;i=a.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu"),d(),i.find("li").removeClass("menu-focus"),i.last().parent().removeClass("menu-focus"),j=i.last().parent(),f=this.rootMenus.index(j),g=f<this.rootMenus.length-1?j.next():this.rootMenus.first(),g.addClass("menu-focus"),"true"==g.attr("aria-haspopup")&&(h=g.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h),this.isChildOpen=!0)}return g},e.prototype.moveToPrevious=function(a){var b=a.parent(),c=b.children("li"),e=c.index(a),f=null,g=null;if(b.is(".tool-lp-menu"))f=e>0?a.prev():c.last(),"true"==a.attr("aria-haspopup")&&(g=a.children("ul").first(),"false"==g.attr("aria-hidden")&&(d(),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===f.attr("aria-haspopup")&&this.isChildOpen===!0&&(g=f.children("ul").first(),this.openSubMenu(g));else{var h=b.parent(),i=h.parent();i.is(".tool-lp-menu")?(d(),a.removeClass("menu-focus"),h.removeClass("menu-focus"),e=this.rootMenus.index(h),f=e>0?h.prev():this.rootMenus.last(),f.addClass("menu-focus"),"true"==f.attr("aria-haspopup")&&(g=f.children("ul").first(),this.openSubMenu(g),this.isChildOpen=!0,f=g.children("li").first())):(f=b.parent(),d(),a.removeClass("menu-focus"))}return f},e.prototype.moveDown=function(a,b){var c=a.parent(),d=c.children("li").not(".separator"),e=d.length,f=d.index(a),g=null,h=null;if(c.is(".tool-lp-menu"))return"true"!=a.attr("aria-haspopup")?a:(h=a.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h),g);if(b){var i=!1,j=f+1;for(j==e&&(j=0);j!=f;){var k=d.eq(j).html().charAt(0);if(k.toLowerCase()==b){i=!0;break}j+=1,j==e&&(j=0)}return i===!0?(g=d.eq(j),a.removeClass("menu-focus"),g):a}return g=e-1>f?d.eq(f+1):d.first(),a.removeClass("menu-focus"),g},e.prototype.moveUp=function(a){var b=a.parent(),c=b.children("li").not(".separator"),d=c.index(a),e=null;return b.is(".tool-lp-menu")?a:(e=d>0?c.eq(d-1):c.last(),a.removeClass("menu-focus"),e)},e.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu")},{enhance:function(b,c){a(b).each(function(b,d){var f=a(d);f.data("menubarEnhanced")!==!0&&(new e(f,c),f.data("menubarEnhanced",!0))})},closeAll:d}});