{"version":3,"file":"question_engine.min.js","sources":["../src/question_engine.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript required by the question engine.\n *\n * @module     core_question/question_engine\n * @copyright  2021 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as scrollManager from 'core/scroll_manager';\nimport * as formSubmit from 'core_form/submit';\n\n/**\n * Initialise a question submit button. This saves the scroll position and\n * sets the fragment on the form submit URL so the page reloads in the right place.\n *\n * @param {string} button the id of the button in the HTML.\n */\nexport const initSubmitButton = button => {\n    formSubmit.init(button);\n    scrollManager.watchScrollButtonSaves();\n};\n\n/**\n * Initialise a form that contains questions printed using print_question.\n * This has the effect of:\n * 1. Turning off browser autocomlete.\n * 2. Stopping enter from submitting the form (or toggling the next flag) unless\n *    keyboard focus is on the submit button or the flag.\n * 3. Removes any '.questionflagsavebutton's, since we have JavaScript to toggle\n *    the flags using ajax.\n * 4. Scroll to the position indicated by scrollpos= in the URL, if it is there.\n * 5. Prevent the user from repeatedly submitting the form.\n *\n * @param {string} formSelector Selector to identify the form.\n */\nexport const initForm = (formSelector) => {\n    const form = document.querySelector(formSelector);\n    form.setAttribute('autocomplete', 'off');\n\n    form.addEventListener('submit', preventRepeatSubmission);\n\n    form.addEventListener('key', (event) => {\n        if (event.keyCode !== 13) {\n            return;\n        }\n\n        if (event.target.matches('a')) {\n            return;\n        }\n\n        if (event.target.matches('input[type=\"submit\"]')) {\n            return;\n        }\n\n        if (event.target.matches('input[type=img]')) {\n            return;\n        }\n\n        if (event.target.matches('textarea') || event.target.matches('[contenteditable=true]')) {\n            return;\n        }\n\n        event.preventDefault();\n    });\n\n    const questionFlagSaveButtons = form.querySelectorAll('.questionflagsavebutton');\n    [...questionFlagSaveButtons].forEach((node) => node.remove());\n\n    // Note: The scrollToSavedPosition function tries to wait until the content has loaded before firing.\n    scrollManager.scrollToSavedPosition();\n};\n\n/**\n * Event handler to stop a question form being submitted more than once.\n *\n * @param {object} event the form submit event.\n */\nexport const preventRepeatSubmission = (event) => {\n    const form = event.target.closest('form');\n    if (form.dataset.formSubmitted === '1') {\n        event.preventDefault();\n        return;\n    }\n\n    setTimeout(() => {\n        [...form.querySelectorAll('input[type=submit]')].forEach((input) => input.setAttribute('disabled', true));\n    });\n    form.dataset.formSubmitted = '1';\n};\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","_typeof","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_toConsumableArray","arr","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","iter","Symbol","iterator","from","_iterableToArray","o","minLen","n","toString","slice","constructor","name","test","_unsupportedIterableToArray","TypeError","_nonIterableSpread","len","length","i","arr2","scrollManager","formSubmit","_exports","initSubmitButton","button","init","watchScrollButtonSaves","initForm","formSelector","form","document","querySelector","setAttribute","addEventListener","preventRepeatSubmission","event","keyCode","target","matches","preventDefault","querySelectorAll","forEach","node","remove","scrollToSavedPosition","closest","dataset","formSubmitted","setTimeout","input"],"mappings":"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"}