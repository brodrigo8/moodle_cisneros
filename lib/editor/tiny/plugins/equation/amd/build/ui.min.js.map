{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Equation UI.\n *\n * @module      tiny_equation/ui\n * @copyright   2022 Huong Nguyen <huongnv13@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport EquationModal from 'tiny_equation/modal';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {getLibraries, getTexDocsUrl} from 'tiny_equation/options';\nimport {notifyFilterContentUpdated} from 'core/event';\nimport * as TinyEquationRepository from 'tiny_equation/repository';\nimport {displayException} from 'core/notification';\nimport {debounce} from 'core/utils';\nimport Selectors from 'tiny_equation/selectors';\nimport {getSourceEquation, getCurrentEquationData, setEquation} from 'tiny_equation/equation';\n\nlet currentForm;\nlet lastCursorPos = 0;\n\n/**\n * Handle action\n * @param {TinyMCE} editor\n */\nexport const handleAction = (editor) => {\n    displayDialogue(editor);\n};\n\n/**\n * Display the equation editor\n * @param {TinyMCE} editor\n * @returns {Promise<void>}\n */\nconst displayDialogue = async(editor) => {\n    let data = {};\n    const currentEquationData = getCurrentEquationData(editor);\n    if (currentEquationData) {\n        Object.assign(data, currentEquationData);\n    }\n    const modalPromises = await ModalFactory.create({\n        type: EquationModal.TYPE,\n        templateContext: getTemplateContext(editor, data),\n        large: true,\n    });\n\n    modalPromises.show();\n    const $root = await modalPromises.getRoot();\n    const root = $root[0];\n    currentForm = root.querySelector(Selectors.elements.form);\n\n    $root.on(ModalEvents.hidden, () => {\n        modalPromises.destroy();\n    });\n\n    $root.on(ModalEvents.shown, () => {\n        const library = root.querySelector(Selectors.elements.library);\n        TinyEquationRepository.filterEquation(1, library.innerHTML).then(async data => {\n            library.innerHTML = data.content;\n            updatePreview();\n            notifyFilter(library);\n            return data;\n        }).catch(displayException);\n    });\n\n    root.addEventListener('click', (e) => {\n        const libraryItem = e.target.closest(Selectors.elements.libraryItem);\n        const submitAction = e.target.closest(Selectors.actions.submit);\n        const textArea = e.target.closest('.tiny_equation_equation');\n        if (libraryItem) {\n            e.preventDefault();\n            selectLibraryItem(libraryItem);\n        }\n        if (submitAction) {\n            e.preventDefault();\n            setEquation(currentForm, editor);\n            modalPromises.destroy();\n        }\n        if (textArea) {\n            debounce(updatePreview(), 500);\n        }\n    });\n\n    root.addEventListener('keyup', (e) => {\n        const textArea = e.target.closest(Selectors.elements.equationTextArea);\n        if (textArea) {\n            debounce(updatePreview(), 500);\n        }\n    });\n\n    root.addEventListener('keydown', (e) => {\n        const libraryItem = e.target.closest(Selectors.elements.libraryItem);\n        if (libraryItem) {\n            if (e.keyCode == 37 || e.keyCode == 39) {\n                groupNavigation(e);\n            }\n        }\n    });\n};\n\n/**\n * Get template context.\n * @param {TinyMCE} editor\n * @param {Object} data\n * @returns {Object}\n */\nconst getTemplateContext = (editor, data) => {\n    const libraries = getLibraries(editor);\n    const texDocsUrl = getTexDocsUrl(editor);\n\n    return Object.assign({}, {\n        elementid: editor.id,\n        libraries: libraries,\n        texdocsurl: texDocsUrl,\n        delimiters: Selectors.delimiters,\n    }, data);\n};\n\n/**\n * Handle select library item.\n * @param {Object} libraryItem\n */\nconst selectLibraryItem = (libraryItem) => {\n    const tex = libraryItem.getAttribute('data-tex');\n    const input = currentForm.querySelector(Selectors.elements.equationTextArea);\n    let oldValue;\n    let newValue;\n    let focusPoint = 0;\n\n    oldValue = input.value;\n\n    newValue = oldValue.substring(0, lastCursorPos);\n    if (newValue.charAt(newValue.length - 1) !== ' ') {\n        newValue += ' ';\n    }\n    newValue += tex;\n    focusPoint = newValue.length;\n\n    if (oldValue.charAt(lastCursorPos) !== ' ') {\n        newValue += ' ';\n    }\n    newValue += oldValue.substring(lastCursorPos, oldValue.length);\n\n    input.value = newValue;\n    input.focus();\n\n    input.selectionStart = input.selectionEnd = focusPoint;\n\n    updatePreview();\n};\n\n/**\n * Update the preview section.\n */\nconst updatePreview = () => {\n    const textarea = currentForm.querySelector(Selectors.elements.equationTextArea);\n    const preview = currentForm.querySelector(Selectors.elements.preview);\n    const prefix = '';\n    const cursorLatex = Selectors.cursorLatex;\n    const isChar = /[a-zA-Z{]/;\n    let currentPos = textarea.selectionStart;\n    let equation = textarea.value;\n\n    // Move the cursor so it does not break expressions.\n    // Start at the very beginning.\n    if (!currentPos) {\n        currentPos = 0;\n    }\n\n    if (getSourceEquation()) {\n        currentPos = equation.length;\n    }\n\n    // First move back to the beginning of the line.\n    while (equation.charAt(currentPos) === '\\\\' && currentPos >= 0) {\n        currentPos -= 1;\n    }\n    if (currentPos !== 0) {\n        if (equation.charAt(currentPos - 1) != '{') {\n            // Now match to the end of the line.\n            while (isChar.test(equation.charAt(currentPos)) &&\n                    currentPos < equation.length &&\n                    isChar.test(equation.charAt(currentPos - 1))) {\n                currentPos += 1;\n            }\n        }\n    }\n    // Save the cursor position - for insertion from the library.\n    lastCursorPos = currentPos;\n    equation = prefix + equation.substring(0, currentPos) + cursorLatex + equation.substring(currentPos);\n\n    equation = Selectors.delimiters.start + ' ' + equation + ' ' + Selectors.delimiters.end;\n    TinyEquationRepository.filterEquation(1, equation).then((data) => {\n        preview.innerHTML = data.content;\n        notifyFilter(preview);\n\n        return data;\n    }).catch(displayException);\n};\n\n/**\n * Notify the filters about the modified nodes\n * @param {Element} element\n */\nconst notifyFilter = (element) => {\n    notifyFilterContentUpdated(element);\n};\n\n/**\n * Callback handling the keyboard navigation in the groups of the library.\n * @param {Event} e\n */\nconst groupNavigation = (e) => {\n    e.preventDefault();\n\n    const current = e.target.closest(Selectors.elements.libraryItem);\n    const parent = current.parentNode; // This must be the <div> containing all the buttons of the group.\n    const buttons = Array.prototype.slice.call(parent.querySelectorAll(Selectors.elements.libraryItem));\n    const direction = e.keyCode !== 37 ? 1 : -1;\n    let index = buttons.indexOf(current);\n    let nextButton;\n\n    if (index < 0) {\n        index = 0;\n    }\n\n    index += direction;\n    if (index < 0) {\n        index = buttons.length - 1;\n    } else if (index >= buttons.length) {\n        index = 0;\n    }\n    nextButton = buttons[index];\n    nextButton.focus();\n};\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireDefault","obj","__esModule","default","_regeneratorRuntime","exports","Op","Object","prototype","hasOwn","hasOwnProperty","defineProperty","key","desc","value","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","makeInvokeMethod","tryCatch","fn","arg","type","call","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","method","_invoke","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","result","_typeof","__await","then","unwrapped","error","previousPromise","callInvokeWithMethodAndArg","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","done","methodName","undefined","return","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","length","i","displayName","isGeneratorFunction","genFun","ctor","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","keys","val","object","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","args","arguments","apply","currentForm","_modal","_modal_factory","_modal_events","TinyEquationRepository","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","set","_interopRequireWildcard","_selectors","lastCursorPos","_exports","handleAction","editor","displayDialogue","_ref","data","currentEquationData","modalPromises","$root","root","_context2","getCurrentEquationData","assign","ModalFactory","EquationModal","TYPE","templateContext","getTemplateContext","large","show","getRoot","querySelector","Selectors","elements","form","on","ModalEvents","hidden","destroy","shown","_ref2","library","filterEquation","innerHTML","_context","content","updatePreview","notifyFilter","_callee","_x2","displayException","addEventListener","e","libraryItem","target","closest","submitAction","actions","submit","textArea","preventDefault","selectLibraryItem","setEquation","debounce","equationTextArea","keyCode","groupNavigation","_callee2","_x","libraries","getLibraries","texDocsUrl","getTexDocsUrl","elementid","id","texdocsurl","delimiters","oldValue","newValue","focusPoint","tex","getAttribute","input","substring","focus","selectionStart","selectionEnd","textarea","preview","cursorLatex","isChar","currentPos","equation","getSourceEquation","test","start","end","element","notifyFilterContentUpdated","current","parent","parentNode","buttons","Array","querySelectorAll","direction","index","indexOf"],"mappings":"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"}