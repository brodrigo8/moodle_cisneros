{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Add search filtering of available language packs\n *\n * @module      tool_langimport/search\n * @copyright   2021 Paul Holden <paulh@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Pending from 'core/pending';\nimport {debounce} from 'core/utils';\n\nconst SELECTORS = {\n    AVAILABLE_LANG_SELECT: 'select',\n    AVAILABLE_LANG_SEARCH: '[data-action=\"search\"]',\n};\n\nconst DEBOUNCE_TIMER = 250;\n\n/**\n * Initialize module\n *\n * @param {Element} form\n */\nconst init = (form) => {\n    const availableLangsElement = form.querySelector(SELECTORS.AVAILABLE_LANG_SELECT);\n\n    const availableLangsFilter = (event) => {\n        const pendingPromise = new Pending('tool_langimport/search:filter');\n\n        // Remove existing options.\n        availableLangsElement.querySelectorAll('option').forEach((option) => {\n            option.remove();\n        });\n\n        // Filter for matching languages.\n        const searchTerm = event.target.value.toLowerCase();\n        const availableLanguages = JSON.parse(availableLangsElement.dataset.availableLanguages);\n        const filteredLanguages = Object.keys(availableLanguages).reduce((matches, langcode) => {\n            if (availableLanguages[langcode].toLowerCase().includes(searchTerm)) {\n                matches[langcode] = availableLanguages[langcode];\n            }\n            return matches;\n        }, []);\n\n        // Re-create filtered options.\n        Object.entries(filteredLanguages).forEach(([langcode, langname]) => {\n            const option = document.createElement('option');\n            option.value = langcode;\n            option.innerText = langname;\n            availableLangsElement.append(option);\n        });\n\n        pendingPromise.resolve();\n    };\n\n    // Cache initial available language options.\n    const availableLanguages = {};\n    availableLangsElement.querySelectorAll('option').forEach((option) => {\n        availableLanguages[option.value] = option.text;\n    });\n    availableLangsElement.dataset.availableLanguages = JSON.stringify(availableLanguages);\n\n    // Register event listeners on the search element.\n    const availableLangsSearch = form.querySelector(SELECTORS.AVAILABLE_LANG_SEARCH);\n    availableLangsSearch.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter') {\n            event.preventDefault();\n        }\n    });\n\n    // Debounce the event listener to allow the user to finish typing.\n    availableLangsSearch.addEventListener('keyup', (event) => {\n        const pendingPromise = new Pending('tool_langimport/search:keyup');\n\n        debounce(availableLangsFilter, DEBOUNCE_TIMER)(event);\n        setTimeout(() => {\n            pendingPromise.resolve();\n        }, DEBOUNCE_TIMER);\n    });\n};\n\nexport default {\n    init: init,\n};\n"],"names":["obj","_slicedToArray","arr","i","Array","isArray","_arrayWithHoles","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","return","_iterableToArrayLimit","o","minLen","_arrayLikeToArray","n","prototype","toString","slice","constructor","name","from","test","_unsupportedIterableToArray","TypeError","_nonIterableRest","len","arr2","_pending","__esModule","default","SELECTORS","_default","init","form","availableLangsElement","querySelector","availableLangsFilter","event","pendingPromise","Pending","querySelectorAll","forEach","option","remove","searchTerm","target","toLowerCase","availableLanguages","JSON","parse","dataset","filteredLanguages","keys","reduce","matches","langcode","includes","entries","_ref","_ref2","langname","document","createElement","innerText","append","resolve","text","stringify","availableLangsSearch","addEventListener","key","preventDefault","debounce","setTimeout","_exports"],"mappings":"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"}