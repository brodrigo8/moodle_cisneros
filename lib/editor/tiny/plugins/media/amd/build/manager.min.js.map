{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Media Manager plugin class for Moodle.\n *\n * @module      tiny_media/manager\n * @copyright   2022, Stevani Andolo <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {getData} from './options';\nimport Config from 'core/config';\n\nexport const MediaManager = class {\n\n    editor = null;\n    area = null;\n\n    constructor(editor) {\n        this.editor = editor;\n        const data = getData(editor);\n        this.area = data.params.area;\n        this.area.itemid = data.fpoptions.image.itemid;\n    }\n\n    displayDialogue = () => {\n        Modal.create({\n            type: Modal.types.DEFAULT,\n            large: true,\n            title: getString('mediamanagerproperties', 'tiny_media'),\n            body: Templates.render('tiny_media/mm_iframe', {\n                src: this.getIframeURL()\n            })\n        }).then(modal => {\n            modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                this.selectFirstElement();\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            modal.show();\n            document.querySelector('.modal-lg').style.cssText = `max-width: 850px`;\n            return modal;\n        }).catch();\n    };\n\n    // It will select the first element in the file manager.\n    selectFirstElement = () => {\n        const iframe = document.getElementById('mm-iframe');\n        iframe.addEventListener('load', function() {\n            let intervalId = setInterval(function() {\n                const iDocument = iframe.contentWindow.document;\n                if (iDocument.querySelector('.filemanager')) {\n                    const firstFocusableElement = iDocument.querySelector('.fp-navbar a:not([disabled])');\n                    if (firstFocusableElement) {\n                        firstFocusableElement.focus();\n                    }\n                    clearInterval(intervalId);\n                }\n            }, 200);\n        });\n    };\n\n    getIframeURL = () => {\n        const url = new URL(`${Config.wwwroot}/lib/editor/tiny/plugins/media/manage.php`);\n        url.searchParams.append('elementid', this.editor.getElement().id);\n        for (const key in this.area) {\n            url.searchParams.append(key, this.area[key]);\n        }\n        return url.toString();\n    };\n};\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","_typeof","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireDefault","Symbol","iterator","constructor","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","_toPropertyKey","_defineProperty","value","arg","input","hint","prim","toPrimitive","undefined","res","TypeError","String","Number","_toPrimitive","_templates","Modal","ModalEvents","_config","Constructor","protoProps","staticProps","MediaManager","editor","_this","this","instance","_classCallCheck","create","type","types","DEFAULT","large","title","getString","body","Templates","render","src","getIframeURL","then","modal","getRoot","on","bodyRendered","selectFirstElement","hidden","destroy","show","document","querySelector","style","cssText","catch","iframe","getElementById","addEventListener","intervalId","setInterval","iDocument","contentWindow","firstFocusableElement","focus","clearInterval","url","URL","Config","wwwroot","searchParams","append","getElement","id","area","toString","data","getData","params","itemid","fpoptions","image","_exports"],"mappings":"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"}