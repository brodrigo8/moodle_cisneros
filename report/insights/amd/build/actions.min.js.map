{"version":3,"sources":["../src/actions.js"],"names":["define","$","Str","Ajax","Notification","ModalFactory","ModalEvents","initBulk","rootNode","noItemsSelected","actionVisibleName","get_strings","key","component","then","strings","create","type","types","CANCEL","title","body","modal","show","catch","exception","executeAction","predictionIds","predictionContainers","actionName","call","methodname","args","predictionids","actionname","tableNode","forEach","el","closest","remove","find","length","window","location","reload","on","e","preventDefault","action","currentTarget","data","text","trim","each","container","push","param","nitems","strs","SAVE_CANCEL","setSaveButtonText","getRoot","save"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to manage report insights actions that are executed using AJAX.\n *\n * @package    report_insights\n * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * This module manages prediction actions that require AJAX requests.\n *\n * @module report_insights/actions\n */\ndefine(['jquery', 'core/str', 'core/ajax', 'core/notification', 'core/modal_factory', 'core/modal_events'],\n        function($, Str, Ajax, Notification, ModalFactory, ModalEvents) {\n\n    return {\n\n        /**\n         * Attach on click handlers for bulk actions.\n         *\n         * @param {String} rootNode\n         * @access public\n         */\n        initBulk: function(rootNode) {\n\n            /**\n             * Show the no items selected note.\n             *\n             * @param  {String} actionVisibleName\n             * @return {Promise}\n             */\n            var noItemsSelected = function(actionVisibleName) {\n                return Str.get_strings([\n                        {key: 'noitemsselected', component: 'report_insights'},\n                ]).then(function(strings) {\n                        return ModalFactory.create({\n                            type: ModalFactory.types.CANCEL,\n                            title: actionVisibleName,\n                            body: strings[0],\n                        });\n                }).then(function(modal) {\n                        modal.show();\n                        return modal;\n                }).catch(Notification.exception);\n            };\n\n            /**\n             * Executes the provided action.\n             *\n             * @param  {Array}  predictionIds\n             * @param  {Array}  predictionContainers\n             * @param  {String} actionName\n             * @return {Promise}\n             */\n            var executeAction = function(predictionIds, predictionContainers, actionName) {\n\n                return Ajax.call([\n                    {\n                        methodname: 'report_insights_action_executed',\n                        args: {\n                            predictionids: predictionIds,\n                            actionname: actionName\n                        }\n                    }\n                ])[0].then(function() {\n                    // Remove the selected elements from the list.\n\n                    var tableNode = false;\n                    predictionContainers.forEach(function(el) {\n                        if (tableNode === false) {\n                            tableNode = el.closest('table');\n                        }\n                        el.remove();\n                    });\n\n                    if (tableNode.find('tbody').length === 0) {\n                        window.location.reload();\n                    }\n                    return;\n                }).catch(Notification.exception);\n            };\n\n            $(rootNode + ' [data-bulk-actionname]').on('click', function(e) {\n                e.preventDefault();\n                var action = $(e.currentTarget);\n                var actionName = action.data('bulk-actionname');\n                var actionVisibleName = action.text().trim();\n\n                var predictionIds = [];\n                var predictionContainers = [];\n\n                $('.insights-list input[data-togglegroup^=\"insight-bulk-action-\"][data-toggle=\"slave\"]:checked').each(function() {\n                    var container = $(this).closest('tbody[data-prediction-id]');\n                    predictionContainers.push(container);\n                    predictionIds.push(container.data('prediction-id'));\n                });\n\n                if (predictionIds.length === 0) {\n                    // No items selected message.\n                    return noItemsSelected(actionVisibleName);\n                }\n\n                var strings = [];\n                return Str.get_strings([{\n                    key: 'confirmbulkaction',\n                    component: 'report_insights',\n                    param: {\n                        action: actionVisibleName,\n                        nitems: predictionIds.length\n                    }\n                }, {\n                    key: 'confirm',\n                    component: 'moodle'\n                }]\n                ).then(function(strs) {\n                    strings = strs;\n                    return ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: actionVisibleName,\n                        body: strings[0],\n                    });\n                }).then(function(modal) {\n                    modal.setSaveButtonText(strings[1]);\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        // The action is now confirmed, sending an action for it.\n                        return executeAction(predictionIds, predictionContainers, actionName);\n                    });\n\n                    return modal;\n                }).catch(Notification.exception);\n            });\n        },\n    };\n});\n"],"file":"actions.min.js"}