define("mod_bigbluebuttonbn/roomupdater",["exports","core/pending","core/templates","core/notification","./repository"],(function(_exports,_pending,_templates,_notification,_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JS room updater.
   *
   * @module      mod_bigbluebuttonbn/roomupdater
   * @copyright   2021 Blindside Networks Inc
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateRoom=_exports.stop=_exports.start=void 0,_pending=_interopRequireDefault(_pending),_templates=_interopRequireDefault(_templates);var timerReference=null,timerRunning=!1,pollInterval=0,pollIntervalFactor=1,resetValues=function(){timerRunning=!1,timerReference=null,pollInterval=0,pollIntervalFactor=1};_exports.start=function(interval){resetValues(),timerRunning=!0,pollInterval=interval,poll()};_exports.stop=function(){timerReference&&clearTimeout(timerReference),resetValues()};var poll=function poll(){timerRunning&&pollInterval&&updateRoom().then((function(updateOk){return updateOk||(pollIntervalFactor=pollIntervalFactor<10?pollIntervalFactor+1:10),timerReference=setTimeout((function(){return poll()}),pollInterval*pollIntervalFactor),!0})).catch()},updateRoom=function(){var updatecache=arguments.length>0&&void 0!==arguments[0]&&arguments[0],bbbRoomViewElement=document.getElementById("bigbluebuttonbn-room-view");if(null===bbbRoomViewElement)return Promise.resolve(!1);var bbbId=bbbRoomViewElement.dataset.bbbId,groupId=bbbRoomViewElement.dataset.groupId,pendingPromise=new _pending.default("mod_bigbluebuttonbn/roomupdater:updateRoom");return(0,_repository.getMeetingInfo)(bbbId,groupId,updatecache).then((function(data){return data.haspresentations=!(!data.presentations||!data.presentations.length),_templates.default.renderForPromise("mod_bigbluebuttonbn/room_view",data)})).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.replaceNode(bbbRoomViewElement,html,js)})).then((function(){return pendingPromise.resolve()})).catch(_notification.exception)};_exports.updateRoom=updateRoom}));

//# sourceMappingURL=roomupdater.min.js.map