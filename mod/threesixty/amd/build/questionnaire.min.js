define(["jquery","core/templates","core/notification","core/ajax","core/str"],function(a,b,c,d,e){function f(b){a(".comment").each(function(){g[a(this).data("itemid")]=a(this).val().trim()});var f=a('[data-region="questionnaire"]').data("touserid"),h=a('[data-region="questionnaire"]').data("threesixtyid");console.log(g);var i=d.call([{methodname:"mod_threesixty_save_responses",args:{threesixtyid:h,touserid:f,responses:g,complete:b}}]);i[0].done(function(a){var d=[{key:"responsessaved",component:"mod_threesixty"},{key:"errorresponsesavefailed",component:"mod_threesixty"}];e.get_strings(d,"mod_threesixty").done(function(b){var d={};a.result?(d.message=b[0],d.type="success"):(d.message=b[1],d.type="error"),c.addNotification(d)}).fail(c.exception),b&&(window.location=a.redirurl)}).fail(c.exception)}var g=[],h=function(){this.registerEvents(),a('[data-region="question-row"]').each(function(){g[a(this).data("itemid")]=null});var b=a('[data-region="questionnaire"]'),c=b.data("fromuserid"),e=b.data("touserid"),f=b.data("threesixtyid"),h=d.call([{methodname:"mod_threesixty_get_responses",args:{threesixtyid:f,fromuserid:c,touserid:e}}]);h[0].done(function(b){a.each(b.responses,function(){var b=this;g[b.item]=b.value,a('[data-region="question-row"]').each(function(){if(a(this).data("itemid")==b.item){var c=a(this).children(".scaleoption");c&&c.each(function(){var c=a(this).find("label");c.data("value")==b.value&&(c.removeClass("label-default"),c.removeClass("label-info"),c.addClass("label-success"))});var d=a(this).find(".comment");if(d){var e=a(this).find("textarea");e.val(b.value)}}})}),console.log(g)})};return h.prototype.registerEvents=function(){a(".scaleoption").click(function(b){b.preventDefault();var c=a(this).parent('[data-region="question-row"]'),d=c.find("label");a.each(d,function(){if(a(this).hasClass("label-success")){a(this).removeClass("label-success"),a(this).addClass("label-default");var b=a(this).attr("for"),c=a("#"+b);c.removeAttr("checked")}});var e=a(this).find("label");e.removeClass("label-default"),e.removeClass("label-info"),e.addClass("label-success");var f=a("#"+e.attr("for"));f.attr("checked","checked");var h=c.data("itemid");g[h]=e.data("value")}),a(".scaleoptionlabel").hover(function(b){b.preventDefault(),a(this).hasClass("label-success")||(a(this).hasClass("label-default")?(a(this).removeClass("label-default"),a(this).addClass("label-info")):(a(this).addClass("label-default"),a(this).removeClass("label-info")))}),a("#save-feedback").click(function(){f(!1)}),a("#submit-feedback").click(function(){f(!0)})},h});