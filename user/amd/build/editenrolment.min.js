define(["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment","core/ajax"],function(a,b,c,d,e,f,g,h,i){var j=function(a){this.contextid=a.contextid,this.courseid=a.courseid,this.initModal(),this.bindUnenrol()};return j.prototype.courseid=0,j.prototype.modal=null,j.prototype.initModal=function(){var a=this,d=b("a.editenrollink");f.create({large:!0,type:f.types.SAVE_CANCEL},d).done(function(f){a.modal=f,a.modal.getRoot().on(g.save,function(b){b.preventDefault(),a.submitEditFormAjax()}),d.click(function(){var d=b(this),f=d.data("fullname"),g=d.attr("rel"),h=a.getBody(g);c.get_string("edituserenrolment","enrol",f).done(function(b){a.modal.setTitle(b),a.modal.setBody(h),a.modal.show()}).fail(e.exception)})}).fail(e.exception)},j.prototype.bindUnenrol=function(){b("a.unenrollink").click(function(a){a.preventDefault();var h=b(this),i=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:h.data("fullname"),course:h.data("coursename")}}];c.get_strings(i).done(function(a){var c=a[0],e=a[1];f.create({body:e,large:!0,title:c,type:f.types.CONFIRM}).done(function(a){a.getRoot().on(g.yes,function(){var a={confirm:1,sesskey:d.sesskey,ue:b(h).attr("rel")};window.location.href=d.wwwroot+"/enrol/unenroluser.php?"+b.param(a)}),a.show()})}).fail(e.exception)})},j.prototype.submitEditFormAjax=function(){var a=this.modal.getRoot().find("form"),d=b(a).find('[name="ue"]').val(),f=b(a).find('[name="status"]').val(),g={courseid:this.courseid,ueid:d,status:f,showform:!0},h=b(a).find('[name="timestart[enabled]"]');if(h.is(":checked")){var j=b(a).find('[name="timestart[year]"]').val(),k=b(a).find('[name="timestart[month]"]').val()-1,l=b(a).find('[name="timestart[day]"]').val(),m=b(a).find('[name="timestart[hour]"]').val(),n=b(a).find('[name="timestart[minute]"]').val(),o=new Date(j,k,l,m,n);g.timestart=o.getTime()/1e3}var p=b(a).find('[name="timeend[enabled]"]');if(p.is(":checked")){var q=b(a).find('[name="timeend[year]"]').val(),r=b(a).find('[name="timeend[month]"]').val()-1,s=b(a).find('[name="timeend[day]"]').val(),t=b(a).find('[name="timeend[hour]"]').val(),u=b(a).find('[name="timeend[minute]"]').val(),v=new Date(q,r,s,t,u);g.timeend=v.getTime()/1e3}var w={methodname:"core_enrol_edit_user_enrolment",args:g},x=this;i.call([w])[0].done(function(a){a.result?(x.modal.hide(),"undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload()):a.formoutput?x.modal.setBody(a.formoutput):c.get_string("erroreditenrolment","enrol").done(function(a){e.addNotification({message:a,type:"error"}),x.modal.hide()}).fail(e.exception)}).fail(e.exception)},j.prototype.getBody=function(a){var b={ueid:a};return h.loadFragment("enrol","user_enrolment_form",this.contextid,b).fail(e.exception)},{init:function(a){new j(a)}}});