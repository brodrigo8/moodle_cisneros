{"version":3,"file":"collapsesections.min.js","sources":["../src/collapsesections.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Collapse or expand all form sections on clicking the expand all / collapse al link.\n *\n * @module core_form/collapsesections\n * @copyright 2021 Bas Brands\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 4.0\n */\n\nimport $ from 'jquery';\nimport Pending from 'core/pending';\n\nconst SELECTORS = {\n    FORMHEADER: '.fheader',\n    FORMCONTAINER: '.fcontainer',\n};\n\nconst CLASSES = {\n    SHOW: 'show',\n    COLLAPSED: 'collapsed'\n};\n\n/**\n * Initialises the form section collapse / expand action.\n *\n * @param {string} collapsesections the collapse/expand link id.\n */\nexport const init = collapsesections => {\n    // All jQuery in this code can be replaced when MDL-71979 is integrated (move to Bootstrap 5).\n    const pendingPromise = new Pending('core_form/collapsesections');\n    const collapsemenu = document.querySelector(collapsesections);\n    const formParent = collapsemenu.closest('form');\n    collapsemenu.addEventListener('keydown', e => {\n        if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            collapsemenu.click();\n        }\n    });\n\n    // Override default collapse class if all containers are expanded on page load\n    let expandedcount = 0;\n    const formcontainercount = $(SELECTORS.FORMCONTAINER).length;\n    $(SELECTORS.FORMCONTAINER).each((_, collapsecontainer) => {\n        if (collapsecontainer.classList.contains(CLASSES.SHOW)) {\n            expandedcount++;\n        }\n    });\n\n    if (formcontainercount === expandedcount) {\n        collapsemenu.classList.remove(CLASSES.COLLAPSED);\n        collapsemenu.setAttribute('aria-expanded', true);\n    }\n\n    collapsemenu.addEventListener('click', () => {\n        let action = 'hide';\n        if (collapsemenu.classList.contains(CLASSES.COLLAPSED)) {\n            action = 'show';\n        }\n\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\n            $(collapsecontainer).collapse(action);\n        });\n    });\n\n    // Ensure collapse menu button adds aria-controls attribute referring to each collapsible element.\n    const collapseElements = $(SELECTORS.FORMHEADER);\n    const collapseElementIds = [...collapseElements].map((element, index) => {\n        element.id = element.id || `collapseElement-${index}`;\n        return element.id;\n    });\n    collapsemenu.setAttribute('aria-controls', collapseElementIds.join(' '));\n\n    $(SELECTORS.FORMCONTAINER).on('hidden.bs.collapse', () => {\n        let allCollapsed = true;\n\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\n            if (collapsecontainer.classList.contains(CLASSES.SHOW)) {\n                allCollapsed = false;\n            }\n        });\n\n        if (allCollapsed) {\n            collapsemenu.classList.add(CLASSES.COLLAPSED);\n            collapsemenu.setAttribute('aria-expanded', false);\n        }\n    });\n    $(SELECTORS.FORMCONTAINER).on('shown.bs.collapse', () => {\n        let allExpanded = true;\n\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\n            if (!collapsecontainer.classList.contains(CLASSES.SHOW)) {\n                allExpanded = false;\n            }\n        });\n\n        if (allExpanded) {\n            collapsemenu.classList.remove(CLASSES.COLLAPSED);\n            collapsemenu.setAttribute('aria-expanded', true);\n        }\n    });\n    pendingPromise.resolve();\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","iter","Symbol","iterator","from","_iterableToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","test","_unsupportedIterableToArray","TypeError","_nonIterableSpread","len","length","i","arr2","_jquery","_pending","SELECTORS","CLASSES","_exports","init","collapsesections","pendingPromise","Pending","collapsemenu","document","querySelector","formParent","closest","addEventListener","e","key","preventDefault","click","expandedcount","formcontainercount","$","each","_","collapsecontainer","classList","contains","remove","setAttribute","action","querySelectorAll","forEach","collapse","collapseElementIds","map","element","index","id","concat","join","on","allCollapsed","add","allExpanded","resolve"],"mappings":"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"}